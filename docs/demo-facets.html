<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Christian McDonald">

<title>Transforms &amp; Facets – Intro to OpenRefine</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-7fcf3564f226491e16971c72581e7bae.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./demo-facets.html">Demos</a></li><li class="breadcrumb-item"><a href="./demo-facets.html">Transforms &amp; Facets</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Intro to OpenRefine</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Demos</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./demo-facets.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Transforms &amp; Facets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./demo-cluster.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Clustering</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Case studies</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./case-ahrq.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AHRQ diagnosis codes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./case-ash.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ASH cemetery</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-story-behind-the-lesson" id="toc-the-story-behind-the-lesson" class="nav-link active" data-scroll-target="#the-story-behind-the-lesson">The story behind the lesson</a></li>
  <li><a href="#start-with-some-data" id="toc-start-with-some-data" class="nav-link" data-scroll-target="#start-with-some-data">Start with some data</a></li>
  <li><a href="#start-an-openrefine-project" id="toc-start-an-openrefine-project" class="nav-link" data-scroll-target="#start-an-openrefine-project">Start an OpenRefine project</a>
  <ul class="collapse">
  <li><a href="#getting-around" id="toc-getting-around" class="nav-link" data-scroll-target="#getting-around">Getting around</a></li>
  </ul></li>
  <li><a href="#create-a-new-column" id="toc-create-a-new-column" class="nav-link" data-scroll-target="#create-a-new-column">Create a new column</a></li>
  <li><a href="#common-transforms" id="toc-common-transforms" class="nav-link" data-scroll-target="#common-transforms">Common transforms</a>
  <ul class="collapse">
  <li><a href="#trim" id="toc-trim" class="nav-link" data-scroll-target="#trim">Trim</a></li>
  <li><a href="#change-to-uppercase" id="toc-change-to-uppercase" class="nav-link" data-scroll-target="#change-to-uppercase">Change to uppercase</a></li>
  </ul></li>
  <li><a href="#undo" id="toc-undo" class="nav-link" data-scroll-target="#undo">Undo</a></li>
  <li><a href="#text-facets" id="toc-text-facets" class="nav-link" data-scroll-target="#text-facets">Text facets</a>
  <ul class="collapse">
  <li><a href="#sort" id="toc-sort" class="nav-link" data-scroll-target="#sort">Sort</a></li>
  <li><a href="#edit-value-from-a-text-facet" id="toc-edit-value-from-a-text-facet" class="nav-link" data-scroll-target="#edit-value-from-a-text-facet">Edit value from a text facet</a></li>
  <li><a href="#practice-editing-from-a-text-facet" id="toc-practice-editing-from-a-text-facet" class="nav-link" data-scroll-target="#practice-editing-from-a-text-facet">Practice editing from a text facet</a></li>
  </ul></li>
  <li><a href="#text-filter" id="toc-text-filter" class="nav-link" data-scroll-target="#text-filter">Text filter</a></li>
  <li><a href="#search-and-replace-with-transform" id="toc-search-and-replace-with-transform" class="nav-link" data-scroll-target="#search-and-replace-with-transform">Search and replace with Transform</a></li>
  <li><a href="#adding-values-based-on-other-columns" id="toc-adding-values-based-on-other-columns" class="nav-link" data-scroll-target="#adding-values-based-on-other-columns">Adding values based on other columns</a>
  <ul class="collapse">
  <li><a href="#create-a-blank-column" id="toc-create-a-blank-column" class="nav-link" data-scroll-target="#create-a-blank-column">Create a blank column</a></li>
  </ul></li>
  <li><a href="#filter-with-regular-expressions" id="toc-filter-with-regular-expressions" class="nav-link" data-scroll-target="#filter-with-regular-expressions">Filter with regular expressions</a>
  <ul class="collapse">
  <li><a href="#set-up-the-filter" id="toc-set-up-the-filter" class="nav-link" data-scroll-target="#set-up-the-filter">Set up the filter</a></li>
  <li><a href="#fill-text-with-transform" id="toc-fill-text-with-transform" class="nav-link" data-scroll-target="#fill-text-with-transform">Fill text with Transform</a></li>
  <li><a href="#practice-filter-and-fill" id="toc-practice-filter-and-fill" class="nav-link" data-scroll-target="#practice-filter-and-fill">Practice filter and fill</a></li>
  </ul></li>
  <li><a href="#exporting-your-cleaned-data" id="toc-exporting-your-cleaned-data" class="nav-link" data-scroll-target="#exporting-your-cleaned-data">Exporting your cleaned data</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/utdata/openrefine/blob/main/demo-facets.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/utdata/openrefine/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./demo-facets.html">Demos</a></li><li class="breadcrumb-item"><a href="./demo-facets.html">Transforms &amp; Facets</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Transforms &amp; Facets</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Christian McDonald </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p>This lesson outlines the basics of text facets, filters and data cleaning in OpenRefine. It assumes you have already installed OpenRefine.</p>
<section id="the-story-behind-the-lesson" class="level2">
<h2 class="anchored" data-anchor-id="the-story-behind-the-lesson">The story behind the lesson</h2>
<p>For this story we wanted to summarize candidate election campaign contributions by race, party and election cycle. Before doing so, we had to clean up the campaign fund names and normalize some other columns in the data.</p>
</section>
<section id="start-with-some-data" class="level2">
<h2 class="anchored" data-anchor-id="start-with-some-data">Start with some data</h2>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="data/tec-totals-preclean.xlsx" download="tec-totals-preclean.xlsx">Download TEC campaign finance data</a></p>
</div>
</div>
</div>
<ol type="1">
<li><p>Download the data using the link above. It should go to your Downloads folder. You would usually move the file to some organized project folder.</p>
<p>You don’t need to open it now, but this is what the file looks like in Excel:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/tec-data-peek.png" class="img-fluid figure-img"></p>
<figcaption>Data peek</figcaption>
</figure>
</div></li>
</ol>
<p>There are several things we’d like to do with this data:</p>
<ul>
<li>Create a new “Candidate” column based on the PAC-based “Name” column, but clean up the values to just the candidate’s name.</li>
<li>Create a new “Election Cycle” column so we can later summarize the amounts over these two-year cycles.</li>
<li>Normalize the “Race-Ethnicity” and “Party” columns.</li>
</ul>
</section>
<section id="start-an-openrefine-project" class="level2">
<h2 class="anchored" data-anchor-id="start-an-openrefine-project">Start an OpenRefine project</h2>
<ol type="1">
<li><p>Launch the OpenRefine program (as you normally would for your operating system.)</p>
<p>When you launch OpenRefine it loads in your default browser at <code>http://127.0.0.1:3333/</code>. That is normal. Both the program and the browser need to run, but you work within the browser.</p>
<p>When you launch OpenRefine you’ll see a number of menu items to the left.</p></li>
<li><p>Choose the <strong>Create Project</strong> item.</p></li>
<li><p>Make sure you are on the <strong>This Computer</strong> option.</p></li>
<li><p>Click the <strong>Choose Files</strong> button and go select the TEC Excel file you downloaded.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/tec-choose-files.png" class="img-fluid figure-img"></p>
<figcaption>Choose files</figcaption>
</figure>
</div></li>
<li><p>Once you’ve found your file, click on the <strong>Next</strong> button.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/tec-parse-data.png" class="img-fluid figure-img"></p>
<figcaption>Parse data</figcaption>
</figure>
</div>
<p>There are several options you can adjust here. This workbook only has one sheet, but if your source file had more than one you could choose it here. You can also choose to ignore rows at the top fof the file and such.</p></li>
<li><p>Click on the <strong>Create Project</strong> button to get started.</p></li>
</ol>
<section id="getting-around" class="level3">
<h3 class="anchored" data-anchor-id="getting-around">Getting around</h3>
<p>Once in our project, there are a couple of controls along the top you should play with:</p>
<ol type="1">
<li><p>Change the number of rows you can see</p></li>
<li><p>Page through the data using next, last, previous, first.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/tec-page.png" class="img-fluid figure-img"></p>
<figcaption>Page data</figcaption>
</figure>
</div></li>
</ol>
</section>
</section>
<section id="create-a-new-column" class="level2">
<h2 class="anchored" data-anchor-id="create-a-new-column">Create a new column</h2>
<p>You usually want to keep your original data so you can refer back to it, so we’ll make a new column before we change our data significantly.</p>
<ol type="1">
<li><p>On the <em>Name</em> column, use the dropdown to Edit Column &gt; <strong>Add a column based on this column</strong>. Like this:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/tec-add-column.png" class="img-fluid figure-img"></p>
<figcaption>Add column</figcaption>
</figure>
</div>
<p>You’ll next get a window where we can define what we want in this new column.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/tec-newcol-setup.png" class="img-fluid figure-img"></p>
<figcaption>New column setup</figcaption>
</figure>
</div>
<p>Take note of the “Expression” window here. You can do a LOT more with this than we are here, but inside we have the expression <code>value</code>, which means we want to use the “value” of our original column as the content for each row of our new columns. It is possible to make changes to the value (the content) as you create the new column using <a href="https://docs.openrefine.org/manual/grelfunctions">GREL</a>, a programming language specific to Refine.</p></li>
<li><p>For the “New column name” type in <strong>Candidate</strong>.</p></li>
<li><p>Leave the Expression field as <code>value</code>.</p></li>
<li><p><strong>Click OK</strong> to create the new column.</p></li>
</ol>
</section>
<section id="common-transforms" class="level2">
<h2 class="anchored" data-anchor-id="common-transforms">Common transforms</h2>
<p>Sometimes cells in data have spaces at the beginning or end of the values that you can’t see, and this can cause problems later. We can fix that quickly with Trim.</p>
<section id="trim" class="level3">
<h3 class="anchored" data-anchor-id="trim">Trim</h3>
<ol type="1">
<li><p>Click on the dropdown for the <em>Candidate</em> column and go to Edit cells &gt; Common transforms &gt; <strong>Trim leading and trailing whitespace</strong>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/tec-trim.png" class="img-fluid figure-img"></p>
<figcaption>Trim</figcaption>
</figure>
</div></li>
</ol>
<p>When you do you’ll get a message about how many fields changed.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/tec-trim-result.png" class="img-fluid figure-img"></p>
<figcaption>Trim result</figcaption>
</figure>
</div>
</section>
<section id="change-to-uppercase" class="level3">
<h3 class="anchored" data-anchor-id="change-to-uppercase">Change to uppercase</h3>
<p>You may have noticed other things you can do under Common transforms, like changing everything to UPPERCASE, or removing extra spaces and such.</p>
<p>Let’s use this to change all the “d” and “r” in the Party field to uppercase.</p>
<ol type="1">
<li><p>Use the dropdown on the <em>Party</em> column to choose Edit cells &gt; Common transforms &gt; <strong>To uppercase</strong>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/tec-transform-uc.png" class="img-fluid figure-img"></p>
<figcaption>To uppercase</figcaption>
</figure>
</div></li>
</ol>
<p>Now you have “D” and “R” for Party.</p>
</section>
</section>
<section id="undo" class="level2">
<h2 class="anchored" data-anchor-id="undo">Undo</h2>
<p>Note at the top left of OpenRefine there is an Undo / Redo panel.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/tec-undo.png" class="img-fluid figure-img"></p>
<figcaption>Undo</figcaption>
</figure>
</div>
<p>OpenRefine keeps track of every move you do, and you can go back in time. This should give you great freedom to try things because you can always back out of it.</p>
<p>You can also Extract the steps and Apply them later if you want to save steps to perform again. (This can be a way to have a record of how you cleaned your data so others or your future self can repeat your work.) The format is a JSON file.</p>
</section>
<section id="text-facets" class="level2">
<h2 class="anchored" data-anchor-id="text-facets">Text facets</h2>
<p>One of the most useful skills in OpenRefine is find and change many cells of data in a column at once. The Text facet function gives you a list of all the unique values in your data and tells you in how many rows it shows up.</p>
<ol type="1">
<li><p>Go to the dropdown for <em>Candidate</em> and then to Facet &gt; <strong>Text facet</strong>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/tec-text-facet.png" class="img-fluid figure-img"></p>
<figcaption>Text facet</figcaption>
</figure>
</div>
<p>That will make a list of the values on the left of your screen.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/tec-text-facet-candidate.png" class="img-fluid figure-img"></p>
<figcaption>Text facet candidates</figcaption>
</figure>
</div></li>
</ol>
<p>OpenRefine found that there are 319 unique values for Candidate in your data, along with a number in grey after it to tell you how many rows have that value.</p>
<section id="sort" class="level3">
<h3 class="anchored" data-anchor-id="sort">Sort</h3>
<p>The values are listed alphabetically, which can be helpful to find records that are not quite alike but should be.</p>
<ol type="1">
<li>Click on <strong>Sort by count</strong> link in the facet header to show the facets that have the most values.</li>
<li>Click <strong>Sort by name</strong> to return to the alphabetical list.</li>
</ol>
</section>
<section id="edit-value-from-a-text-facet" class="level3">
<h3 class="anchored" data-anchor-id="edit-value-from-a-text-facet">Edit value from a text facet</h3>
<p>Notice that when you roll your cursor over a value in the facet list you get a link where you can edit that value.</p>
<ol type="1">
<li>Scroll down the <em>Candidate</em> facets to find “Citizens For Joe Crabb (DISSOLVED)”.</li>
<li>As you hover your cursor over that value, you’ll see an <strong>edit</strong> menu item. Click on that.</li>
<li>Change the text to say just “Joe Crabb” and hit <strong>Apply</strong>.</li>
</ol>
<p>Once you change those values, the list sorts again and Joe is down by the J’s.</p>
</section>
<section id="practice-editing-from-a-text-facet" class="level3">
<h3 class="anchored" data-anchor-id="practice-editing-from-a-text-facet">Practice editing from a text facet</h3>
<p>A little work on your own to get some practice:</p>
<ol type="1">
<li>Close the <em>Candidate</em> text facet by <strong>clicking the <code>X</code></strong> that is to the left of the facet title.</li>
<li>Clean up the <em>Race-Ethnicity</em> values to spell out those values to Asian, Black, Hispanic, White. This is straightforward facet editing: Create the facet, then edit the values.</li>
</ol>
<p>Once you are done:</p>
<ol type="1">
<li><strong>Close</strong> your <em>Race-Ethnicity</em> facet.</li>
<li>Add back a <strong>text facet</strong> for <em>Candidate</em>.</li>
</ol>
</section>
</section>
<section id="text-filter" class="level2">
<h2 class="anchored" data-anchor-id="text-filter">Text filter</h2>
<p>You’ll notice there are a bunch of Candidate records that start with “Committee to …”. We’ll use a Text filter to help find those.</p>
<ol type="1">
<li><p>From the dropdown on <em>Candidate</em>, choose <strong>Text filter</strong>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/tec-text-filter-menu.png" class="img-fluid figure-img"></p>
<figcaption>Text filter</figcaption>
</figure>
</div>
<p>This puts a box in the left pane under the Candidate facets.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/tec-text-filter-box.png" class="img-fluid figure-img"></p>
<figcaption>Text filter</figcaption>
</figure>
</div></li>
<li><p><strong>Type in</strong> “committee” and you’ll filter the facet list (and the Matching rows pane at right) so you can more easily find the ones to change.</p></li>
<li><p>Go ahead and edit all those records to just the candidate’s name.</p></li>
</ol>
<p>There is a “case sensitive” option if that is helpful for your filters. If you are familiar with “regular expressions” you can check that box and built your match based on patterns instead of text strings.</p>
<p>You can practice using the process to fix some other common terms:</p>
<ul>
<li>“Texa” to catch both Texas and Texans</li>
<li>“Campaign”</li>
</ul>
<p>But when it comes to “Friends”, let’s instead do a search/replace to fix them all at once.</p>
</section>
<section id="search-and-replace-with-transform" class="level2">
<h2 class="anchored" data-anchor-id="search-and-replace-with-transform">Search and replace with Transform</h2>
<p>Now we’ll use the Transform function to search for and replace specific values.</p>
<ol type="1">
<li><p>In your <strong>Text filter</strong> type in <code>Friends of</code> so we can see them, but don’t fix them yet. We’ll instead edit all the rows at once using Transform.</p></li>
<li><p>Click on the <em>Candidate</em> dropdown and go to Edit cells &gt; <strong>Transform</strong>:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/tec-transform-menu.png" class="img-fluid figure-img"></p>
<figcaption>Transform menu</figcaption>
</figure>
</div>
<p>This will bring up a window much like the one we used when we created a new column.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/tec-transform-replace.png" class="img-fluid figure-img"></p>
<figcaption>Transform replace</figcaption>
</figure>
</div>
<p>Note that in the screenshot above, I’ve typed a function into the expression field. This will make our search and replace happen. You need to do the same.</p></li>
<li><p>In the Expression field, type (or copy/paste) this in: <code>replace(value,"Friends of ","")</code></p>
<p>Let’s break this down:</p>
<ul>
<li><code>replace</code> is a <a href="https://openrefine.org/docs/manual/grelfunctions">function in the GREL language</a>. It takes three arguments inside the parentheses, separated by commas:</li>
<li>The first argument is the string we are changing. In our case, we are using the variable <code>value</code>, which refers to the value of the current cell.</li>
<li>The second argument is the string we are searching for. In our case we are searching for <code>"Friends of "</code>. Note we are including the space after “of” since we don’t want to leave it.</li>
<li>The last argument is what we are replacing that text with, which in our case is nothing, but we have to explicitly say that as a string, hence the <code>""</code>.</li>
</ul>
<p>You can see in the preview that we are removing that text from multiple rows.</p></li>
<li><p><strong>Click OK</strong> when you are ready to execute.</p>
<p>If everything went as planned, your Candidate facet will be blank because the Text filter is still active.</p></li>
<li><p>Close the Facet and Text filter windows with the X button at their top-left corner.</p></li>
</ol>
</section>
<section id="adding-values-based-on-other-columns" class="level2">
<h2 class="anchored" data-anchor-id="adding-values-based-on-other-columns">Adding values based on other columns</h2>
<p>Now that you’ve learned text facets and text filters, we’ll use those skills to create a column called Election Cycle that has values of 2009-2010, 2011-2012 and 2013-2014 based on the Year.</p>
<section id="create-a-blank-column" class="level3">
<h3 class="anchored" data-anchor-id="create-a-blank-column">Create a blank column</h3>
<ol type="1">
<li>Use the <em>Year</em> column dropdown to choose <strong>Edit Column &gt; Add column based on this column</strong>.</li>
<li>Name the column <strong>“Election cycle”</strong>.</li>
<li>In the Expression field, remove the <code>value</code> variable and just add two quotes with nothing between them, like this: <code>""</code></li>
<li>Click <strong>OK</strong>.</li>
</ol>
<p>This will create a new column, but there should be <strong>nothing in it</strong> because we filled it with an “empty” string.</p>
</section>
</section>
<section id="filter-with-regular-expressions" class="level2">
<h2 class="anchored" data-anchor-id="filter-with-regular-expressions">Filter with regular expressions</h2>
<p>This isn’t a lesson on regular expressions but <a href="https://docs.google.com/document/d/1DvAM4lnGJLefo9skD8GgM-_9S1BEhpjJfV86yhJavI0/edit?usp=sharing">I do have one here</a> if you are interested. However, we’ll use a simple one here just to show the power of them.</p>
<p>Our aim here is to add the text “2009-2010” in the <strong>Election cycle</strong> anytime a row has a year of <strong>either</strong> 2009 <strong>or</strong> 2010.</p>
<section id="set-up-the-filter" class="level3">
<h3 class="anchored" data-anchor-id="set-up-the-filter">Set up the filter</h3>
<ol type="1">
<li><p>Create a <strong>text facet</strong> on the <em>Year</em> column.</p></li>
<li><p>Create a <strong>text filter</strong> on the <em>Year</em> column.</p></li>
<li><p>In the text filter, add the text <code>2009|2010</code>.</p>
<blockquote class="blockquote">
<p>That <code>|</code> character between the two years is called a “pipe”. You can find it as the Shift of <code>\</code> on your keyboard, right above the Return key.</p>
</blockquote></li>
<li><p>In the text filter, click the checkbox next to <strong>regular expression</strong>.</p></li>
</ol>
<p>This regular expression is used to search patterns of characters instead of actual text. The <code>|</code> key means “or”. So we are filtering for “2009 or 2010”.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/tec-regex-filter.png" class="img-fluid figure-img"></p>
<figcaption>Regex filter</figcaption>
</figure>
</div>
</section>
<section id="fill-text-with-transform" class="level3">
<h3 class="anchored" data-anchor-id="fill-text-with-transform">Fill text with Transform</h3>
<p>Now that we only have 2009 and 2010 rows selected, we can fill our <em>Election cycle</em> column with the text we want.</p>
<ol type="1">
<li><p>Use the dropdown on <em>Election cycle</em> to choose Edit cells &gt; <strong>Transform</strong>.</p></li>
<li><p>Enter the following into expression field: <code>"2009-2010"</code></p></li>
<li><p>Click <strong>OK</strong>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/tec-regex-text.png" class="img-fluid figure-img"></p>
<figcaption>Enter text</figcaption>
</figure>
</div></li>
</ol>
<blockquote class="blockquote">
<p>Don’t forget the quotes. That is what tells Refine to insert this as text.</p>
</blockquote>
<p>You’ll see that we now have our Election cycle filled in.</p>
</section>
<section id="practice-filter-and-fill" class="level3">
<h3 class="anchored" data-anchor-id="practice-filter-and-fill">Practice filter and fill</h3>
<p>On your own, repeat this process for the year collections of “2011-2012” an “2013-2014”. You’ll want to adjust the filter to capture the years you want, then use <strong>Edit cells &gt; Tranform</strong> to fill in the proper cycle.</p>
<p>Once you are done, remove all your facets and text filters!</p>
</section>
</section>
<section id="exporting-your-cleaned-data" class="level2">
<h2 class="anchored" data-anchor-id="exporting-your-cleaned-data">Exporting your cleaned data</h2>
<p>Once you cleaned everything the way you want it, you’ll want to export your changed data to get it out of OpenRefine so you can use it elsewhere.</p>
<ol type="1">
<li><p>Go under the <em>Export</em> button at top-right and choose the export type of your choice.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/tec-export.png" class="img-fluid figure-img"></p>
<figcaption>Export</figcaption>
</figure>
</div></li>
</ol>
<p>This will download your file to your Downloads folder on your computer. Don’t forget to move the file to a safe place where you can find it again.</p>
<p>That’s the end of this example. We’ll handle <a href="./demo-cluster.html">Clustering</a> with a different data set.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/utdata/openrefine/blob/main/demo-facets.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/utdata/openrefine/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>